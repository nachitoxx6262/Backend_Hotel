{
    "examples": [
        {
            "name": "Caso Normal - Stay activa con consumos",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/123/invoice-preview",
                "query_params": {}
            },
            "response": {
                "stay_id": 123,
                "reservation_id": 456,
                "cliente_nombre": "María González",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-10T14:30:00",
                    "checkout_candidate": "2025-12-15",
                    "checkout_planned": "2025-12-15"
                },
                "nights": {
                    "planned": 5,
                    "calculated": 5,
                    "suggested_to_charge": 5,
                    "override_applied": false,
                    "override_value": null
                },
                "room": {
                    "room_id": 201,
                    "numero": "305",
                    "room_type_name": "Suite Ejecutiva",
                    "nightly_rate": 25000.0,
                    "rate_source": "room_type"
                },
                "breakdown_lines": [
                    {
                        "line_type": "room",
                        "description": "Alojamiento - Suite Ejecutiva #305",
                        "quantity": 5.0,
                        "unit_price": 25000.0,
                        "total": 125000.0,
                        "metadata": {
                            "nights": 5,
                            "room_id": 201,
                            "rate_source": "room_type"
                        }
                    },
                    {
                        "line_type": "charge",
                        "description": "Minibar - Agua Mineral",
                        "quantity": 3.0,
                        "unit_price": 500.0,
                        "total": 1500.0,
                        "metadata": {
                            "charge_id": 789,
                            "tipo": "product",
                            "created_at": "2025-12-11T10:00:00"
                        }
                    },
                    {
                        "line_type": "charge",
                        "description": "Room Service - Desayuno",
                        "quantity": 2.0,
                        "unit_price": 3500.0,
                        "total": 7000.0,
                        "metadata": {
                            "charge_id": 790,
                            "tipo": "service",
                            "created_at": "2025-12-12T08:30:00"
                        }
                    },
                    {
                        "line_type": "tax",
                        "description": "IVA 21% sobre alojamiento",
                        "quantity": 1.0,
                        "unit_price": 26250.0,
                        "total": 26250.0,
                        "metadata": {
                            "tax_type": "iva",
                            "rate": 0.21,
                            "base": 125000.0
                        }
                    },
                    {
                        "line_type": "payment",
                        "description": "Pago (tarjeta)",
                        "quantity": 1.0,
                        "unit_price": -80000.0,
                        "total": -80000.0,
                        "metadata": {
                            "payment_id": 321,
                            "metodo": "tarjeta",
                            "referencia": "AUTH789456"
                        }
                    }
                ],
                "totals": {
                    "room_subtotal": 125000.0,
                    "charges_total": 8500.0,
                    "taxes_total": 26250.0,
                    "discounts_total": 0.0,
                    "grand_total": 159750.0,
                    "payments_total": 80000.0,
                    "balance": 79750.0
                },
                "payments": [
                    {
                        "id": 321,
                        "monto": 80000.0,
                        "metodo": "tarjeta",
                        "referencia": "AUTH789456",
                        "timestamp": "2025-12-11T18:00:00",
                        "usuario": "recepcion"
                    }
                ],
                "warnings": [
                    {
                        "code": "BALANCE_DUE",
                        "message": "Saldo pendiente: 79750.00",
                        "severity": "warning"
                    }
                ],
                "readonly": false,
                "generated_at": "2025-12-15T20:30:45"
            }
        },
        {
            "name": "Caso con Descuento y Tarifa Faltante",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/124/invoice-preview",
                "query_params": {
                    "checkout_date": "2025-12-16"
                }
            },
            "response": {
                "stay_id": 124,
                "reservation_id": 457,
                "cliente_nombre": "Hotel Corp SA",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-13T16:00:00",
                    "checkout_candidate": "2025-12-16",
                    "checkout_planned": "2025-12-17"
                },
                "nights": {
                    "planned": 4,
                    "calculated": 3,
                    "suggested_to_charge": 3,
                    "override_applied": false,
                    "override_value": null
                },
                "room": {
                    "room_id": 102,
                    "numero": "101",
                    "room_type_name": "Doble Estándar",
                    "nightly_rate": 0.0,
                    "rate_source": "missing"
                },
                "breakdown_lines": [
                    {
                        "line_type": "room",
                        "description": "Alojamiento - Doble Estándar #101",
                        "quantity": 3.0,
                        "unit_price": 0.0,
                        "total": 0.0,
                        "metadata": {
                            "nights": 3,
                            "room_id": 102,
                            "rate_source": "missing"
                        }
                    },
                    {
                        "line_type": "charge",
                        "description": "Lavandería Express",
                        "quantity": 1.0,
                        "unit_price": 5000.0,
                        "total": 5000.0,
                        "metadata": {
                            "charge_id": 800,
                            "tipo": "service",
                            "created_at": "2025-12-14T11:00:00"
                        }
                    },
                    {
                        "line_type": "discount",
                        "description": "Descuento corporativo 15%",
                        "quantity": 1.0,
                        "unit_price": -750.0,
                        "total": -750.0,
                        "metadata": {
                            "charge_id": 801,
                            "tipo": "discount"
                        }
                    },
                    {
                        "line_type": "tax",
                        "description": "IVA 21% sobre alojamiento",
                        "quantity": 1.0,
                        "unit_price": 0.0,
                        "total": 0.0,
                        "metadata": {
                            "tax_type": "iva",
                            "rate": 0.21,
                            "base": 0.0
                        }
                    }
                ],
                "totals": {
                    "room_subtotal": 0.0,
                    "charges_total": 5000.0,
                    "taxes_total": 0.0,
                    "discounts_total": 750.0,
                    "grand_total": 4250.0,
                    "payments_total": 0.0,
                    "balance": 4250.0
                },
                "payments": [],
                "warnings": [
                    {
                        "code": "MISSING_RATE",
                        "message": "No hay tarifa configurada para Doble Estándar",
                        "severity": "error"
                    },
                    {
                        "code": "NIGHTS_DIFFER",
                        "message": "Noches calculadas (3) difieren de planificadas (4)",
                        "severity": "warning"
                    },
                    {
                        "code": "BALANCE_DUE",
                        "message": "Saldo pendiente: 4250.00",
                        "severity": "warning"
                    }
                ],
                "readonly": false,
                "generated_at": "2025-12-15T20:35:12"
            }
        },
        {
            "name": "Caso con Override de Noches",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/125/invoice-preview",
                "query_params": {
                    "nights_override": 7
                }
            },
            "response": {
                "stay_id": 125,
                "reservation_id": 458,
                "cliente_nombre": "Carlos Ramírez",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-08T12:00:00",
                    "checkout_candidate": "2025-12-15",
                    "checkout_planned": "2025-12-15"
                },
                "nights": {
                    "planned": 7,
                    "calculated": 7,
                    "suggested_to_charge": 7,
                    "override_applied": true,
                    "override_value": 7
                },
                "room": {
                    "room_id": 303,
                    "numero": "502",
                    "room_type_name": "Suite Presidencial",
                    "nightly_rate": 45000.0,
                    "rate_source": "stay"
                },
                "breakdown_lines": [
                    {
                        "line_type": "room",
                        "description": "Alojamiento - Suite Presidencial #502",
                        "quantity": 7.0,
                        "unit_price": 45000.0,
                        "total": 315000.0,
                        "metadata": {
                            "nights": 7,
                            "room_id": 303,
                            "rate_source": "stay"
                        }
                    },
                    {
                        "line_type": "tax",
                        "description": "IVA 21% sobre alojamiento",
                        "quantity": 1.0,
                        "unit_price": 66150.0,
                        "total": 66150.0,
                        "metadata": {
                            "tax_type": "iva",
                            "rate": 0.21,
                            "base": 315000.0
                        }
                    }
                ],
                "totals": {
                    "room_subtotal": 315000.0,
                    "charges_total": 0.0,
                    "taxes_total": 66150.0,
                    "discounts_total": 0.0,
                    "grand_total": 381150.0,
                    "payments_total": 0.0,
                    "balance": 381150.0
                },
                "payments": [],
                "warnings": [
                    {
                        "code": "NIGHTS_OVERRIDE",
                        "message": "Se aplicó override de noches: 7 (calculado: 7)",
                        "severity": "info"
                    },
                    {
                        "code": "BALANCE_DUE",
                        "message": "Saldo pendiente: 381150.00",
                        "severity": "warning"
                    }
                ],
                "readonly": false,
                "generated_at": "2025-12-15T20:40:00"
            }
        },
        {
            "name": "Caso Sobrepago (Pagos > Total)",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/126/invoice-preview",
                "query_params": {}
            },
            "response": {
                "stay_id": 126,
                "reservation_id": 459,
                "cliente_nombre": "Ana Martínez",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-14T15:00:00",
                    "checkout_candidate": "2025-12-15",
                    "checkout_planned": "2025-12-16"
                },
                "nights": {
                    "planned": 2,
                    "calculated": 1,
                    "suggested_to_charge": 1,
                    "override_applied": false,
                    "override_value": null
                },
                "room": {
                    "room_id": 150,
                    "numero": "203",
                    "room_type_name": "Individual",
                    "nightly_rate": 12000.0,
                    "rate_source": "room_type"
                },
                "breakdown_lines": [
                    {
                        "line_type": "room",
                        "description": "Alojamiento - Individual #203",
                        "quantity": 1.0,
                        "unit_price": 12000.0,
                        "total": 12000.0,
                        "metadata": {
                            "nights": 1,
                            "room_id": 150,
                            "rate_source": "room_type"
                        }
                    },
                    {
                        "line_type": "tax",
                        "description": "IVA 21% sobre alojamiento",
                        "quantity": 1.0,
                        "unit_price": 2520.0,
                        "total": 2520.0,
                        "metadata": {
                            "tax_type": "iva",
                            "rate": 0.21,
                            "base": 12000.0
                        }
                    },
                    {
                        "line_type": "payment",
                        "description": "Pago (efectivo)",
                        "quantity": 1.0,
                        "unit_price": -20000.0,
                        "total": -20000.0,
                        "metadata": {
                            "payment_id": 400,
                            "metodo": "efectivo",
                            "referencia": ""
                        }
                    }
                ],
                "totals": {
                    "room_subtotal": 12000.0,
                    "charges_total": 0.0,
                    "taxes_total": 2520.0,
                    "discounts_total": 0.0,
                    "grand_total": 14520.0,
                    "payments_total": 20000.0,
                    "balance": -5480.0
                },
                "payments": [
                    {
                        "id": 400,
                        "monto": 20000.0,
                        "metodo": "efectivo",
                        "referencia": "",
                        "timestamp": "2025-12-14T16:00:00",
                        "usuario": "recepcion"
                    }
                ],
                "warnings": [
                    {
                        "code": "NIGHTS_DIFFER",
                        "message": "Noches calculadas (1) difieren de planificadas (2)",
                        "severity": "warning"
                    },
                    {
                        "code": "OVERPAYMENT",
                        "message": "Sobrepago: 5480.00",
                        "severity": "info"
                    },
                    {
                        "code": "PAYMENTS_EXCEED_TOTAL",
                        "message": "Los pagos (20000.00) superan el total (14520.00)",
                        "severity": "warning"
                    }
                ],
                "readonly": false,
                "generated_at": "2025-12-15T20:45:30"
            }
        },
        {
            "name": "Caso Stay Cerrada (Readonly)",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/127/invoice-preview",
                "query_params": {}
            },
            "response": {
                "stay_id": 127,
                "reservation_id": 460,
                "cliente_nombre": "Pedro Sánchez",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-01T14:00:00",
                    "checkout_candidate": "2025-12-05",
                    "checkout_planned": "2025-12-05"
                },
                "nights": {
                    "planned": 4,
                    "calculated": 4,
                    "suggested_to_charge": 4,
                    "override_applied": false,
                    "override_value": null
                },
                "room": {
                    "room_id": 201,
                    "numero": "305",
                    "room_type_name": "Suite Ejecutiva",
                    "nightly_rate": 25000.0,
                    "rate_source": "room_type"
                },
                "breakdown_lines": [
                    {
                        "line_type": "room",
                        "description": "Alojamiento - Suite Ejecutiva #305",
                        "quantity": 4.0,
                        "unit_price": 25000.0,
                        "total": 100000.0,
                        "metadata": {
                            "nights": 4,
                            "room_id": 201,
                            "rate_source": "room_type"
                        }
                    },
                    {
                        "line_type": "charge",
                        "description": "Parking",
                        "quantity": 4.0,
                        "unit_price": 2000.0,
                        "total": 8000.0,
                        "metadata": {
                            "charge_id": 850,
                            "tipo": "service",
                            "created_at": "2025-12-02T09:00:00"
                        }
                    },
                    {
                        "line_type": "tax",
                        "description": "IVA 21% sobre alojamiento",
                        "quantity": 1.0,
                        "unit_price": 21000.0,
                        "total": 21000.0,
                        "metadata": {
                            "tax_type": "iva",
                            "rate": 0.21,
                            "base": 100000.0
                        }
                    },
                    {
                        "line_type": "payment",
                        "description": "Pago (tarjeta)",
                        "quantity": 1.0,
                        "unit_price": -129000.0,
                        "total": -129000.0,
                        "metadata": {
                            "payment_id": 500,
                            "metodo": "tarjeta",
                            "referencia": "AUTH555888"
                        }
                    }
                ],
                "totals": {
                    "room_subtotal": 100000.0,
                    "charges_total": 8000.0,
                    "taxes_total": 21000.0,
                    "discounts_total": 0.0,
                    "grand_total": 129000.0,
                    "payments_total": 129000.0,
                    "balance": 0.0
                },
                "payments": [
                    {
                        "id": 500,
                        "monto": 129000.0,
                        "metodo": "tarjeta",
                        "referencia": "AUTH555888",
                        "timestamp": "2025-12-05T11:00:00",
                        "usuario": "recepcion"
                    }
                ],
                "warnings": [],
                "readonly": true,
                "generated_at": "2025-12-15T20:50:00"
            }
        },
        {
            "name": "Caso Solo Totales (include_items=false)",
            "request": {
                "method": "GET",
                "url": "/api/calendar/stays/123/invoice-preview",
                "query_params": {
                    "include_items": false
                }
            },
            "response": {
                "stay_id": 123,
                "reservation_id": 456,
                "cliente_nombre": "María González",
                "currency": "ARS",
                "period": {
                    "checkin_real": "2025-12-10T14:30:00",
                    "checkout_candidate": "2025-12-15",
                    "checkout_planned": "2025-12-15"
                },
                "nights": {
                    "planned": 5,
                    "calculated": 5,
                    "suggested_to_charge": 5,
                    "override_applied": false,
                    "override_value": null
                },
                "room": {
                    "room_id": 201,
                    "numero": "305",
                    "room_type_name": "Suite Ejecutiva",
                    "nightly_rate": 25000.0,
                    "rate_source": "room_type"
                },
                "breakdown_lines": [],
                "totals": {
                    "room_subtotal": 125000.0,
                    "charges_total": 8500.0,
                    "taxes_total": 26250.0,
                    "discounts_total": 0.0,
                    "grand_total": 159750.0,
                    "payments_total": 80000.0,
                    "balance": 79750.0
                },
                "payments": [],
                "warnings": [
                    {
                        "code": "BALANCE_DUE",
                        "message": "Saldo pendiente: 79750.00",
                        "severity": "warning"
                    }
                ],
                "readonly": false,
                "generated_at": "2025-12-15T20:55:00"
            }
        }
    ]
}